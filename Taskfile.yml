version: '3'

tasks:
  default:
    desc: "Render the Quarto document (main development task)"
    deps: [instantiate, install-extensions]
    cmds:
      - quarto render

  install-julia:
    desc: "Install Julia 1.11.6 using juliaup and set as default"
    cmds:
      - juliaup add 1.11.6
      - juliaup override set 1.11.6
    status:
      - juliaup status | grep -q "1.11.6"

  instantiate:
    desc: "Activate and instantiate the Julia project environment"
    deps: [install-julia]
    cmds:
      - git submodule update --init --recursive
      - julia +1.11.6 -e "using Pkg; Pkg.activate(\".\"); Pkg.instantiate()"
    sources:
      - Project.toml
      - Manifest.toml
    generates:
      - LocalPreferences.toml

  repl:
    desc: "Launch Julia REPL with project environment active"
    deps: [instantiate]
    cmds:
      - julia +1.11.6 -i -e "using Pkg; Pkg.activate(\".\")"
    interactive: true

  install-extensions:
    desc: "Install Quarto extensions"
    cmds:
      - quarto add kapsner/authors-block --no-prompt
    status:
      - test -d _extensions/authors-block

  preview:
    desc: "Preview the Quarto document with live reload"
    deps: [instantiate, install-extensions]
    cmds:
      - quarto preview
    interactive: true
