---
title: "Towards compositional epidemiological modelling"
author:
  - name: "Samuel P. C. Brand"
    affiliation: "Center for Forecasting and Outbreak Analysis; Centers for Disease Control"
    email: "usi1@cdc.gov"
    orcid: "0000-0003-0645-5367"
  - name: "Samuel Abbott"
    affiliation: "Centre for Mathematical Modelling of Infectious Diseases, London School of Hygiene & Tropical Medicine"
    email: "sam.abbott@lshtm.ac.uk" 
    orcid: "0000-0001-8057-8037"
date: today
abstract: |
  This paper presents a compositional approach to epidemiological modelling that enables "swap-in/swap-out" modelling decisions. We demonstrate the flexibility and power of this paradigm through three case studies that recreate and extend existing infectious disease models, showing how compositional design facilitates model comparison, validation, and methodological innovation in epidemiological research.
format:
  pdf:
    documentclass: article
    geometry: margin=1in
    fontsize: 11pt
    linestretch: 1.5
    keep-tex: true
    number-sections: true
    colorlinks: true
  html:
    toc: true
    number-sections: true
    embed-resources: true
bibliography: references.bib
csl: https://www.zotero.org/styles/plos-computational-biology
execute:
  echo: false
  warning: false
  message: false
  cache: true
---

# Introduction {#sec-introduction}

- Introduce current common uses and limitations of epidemiological modelling in outbreak response and routine real-time surveillance.

## Current limitations in epidemiological modelling

- More specific details on limitations e.g. 
    - Monolithic model construction
    - Tight coupling between different model components,inference methods and implementation
    - Limited reusability and adaptability

- More specific details on problems this causes e.g.
    - Limited reusability, adaptability and retrospective evaluation.
        - Hard to isolate effect of specific modelling choices without large reimplementation.
        - Hard to introduce new/latest methods without large reimplementation.
    - Induces "Pipeline" approach where different models pass information rather than joint modelling.
        - Reduced transparency and reproducibility.
        - Complex implementations over many different models creates high barrier to entry.
    - Particularly problematic during outbreak response when inevitably there are new data sources.

## Our compositional approach

- Outline/explain our compositional modelling paradigm e.g:
    - Core design principles
    - Complex epi models into a composition of modular reusable model components.
- Describe the core Latent vs Observation model split.
- How this has become possible:
    - Advances in probabilistic programming (e.g. Turing)
    - Leveraging multiple dispatch e.g. structs in structs from Julia.


## Contributions of this work

- Theoretical framework: Introduce the idea of combining epi models as input-output layers/submodels which are standalone models themselves (or descibed in a different way).
- Practical implementation: Talk about `EpiAware` struct in struct with method dispatch.
- Discuss layer/submodel modifiers in two contexts: 
    1. Extra details e.g. population structure
    2. Modelling refinements e.g. Day of week effects within a observation model
- Discuss passing the composed model to Pathfinder + Turing for inference.
- Quick overview of concrete case studies (unless this gets repetitive)

## Examples

### Example 1: Recreating Mishra et al. with compositional demonstration {#sec-example1}

<!-- Reference: https://arxiv.org/abs/2006.16487 -->
<!-- Implementation: https://cdcgov.github.io/Rt-without-renewal/stable/showcase/replications/mishra-2020/ -->

- Describe modelling ideas in @mishra2020covid 
  - Time-varying reproduction numbers according to an AR(2) process.
  - Convolution-based serial interval modelling i.e. Renewal model with Serial interval
  - Negative binomial observation models for case data
- Describe swap in options:
  - Swap Rt + renewal approach for direct growth rate modelling e.g. $r(t) \sim$ some latent model.
  - Swap in observation delays and Generation interval rather than serial intervals
- Figure 1:
  - **Panel A**: Original Mishra et al. approach (Rt + renewal with serial interval) - cases and Rt estimates
  - **Panel B**: Compositional swap 1 - Direct growth rate modeling (r(t) instead of Rt) - same data, different latent process
  - **Panel C**: Compositional swap 2 - Generation interval + observation delays (instead of serial interval) - showing methodological refinement
  - **Panel D**: Model comparison and convergence metrics across the three approaches: WAIC for each model variation (bar plot) and overlaid QQ PIT plots on case residuals for each model variation.

# Example 2: Recreating Chatzilena et al. {#sec-example2}

<!-- Reference: https://www.sciencedirect.com/science/article/pii/S1755436519300325 -->
<!-- Implementation: https://cdcgov.github.io/Rt-without-renewal/stable/showcase/replications/chatzilena-2019/ -->

- Describe modelling ideas in @chatzilena2019contemporary
  - SIR model for classic influenza data set.
  - Poisson observations with fixed latent observation rate.
  - Conditionally Poisson observations with a latent observation rate (e.g. stochastic SIR model)
- Describe swap in options:
  - Swap in SEIR model for SIR model
  - Swap in Rt latent process for observation latent process
- Figure 2:
  - **Panel A**: Original Chatzilena et al. approach - cases and parameter estimates
  - **Panel B**: Compositional swap 1 - SEIR model - cases and parameter estimates
  - **Panel C**: Compositional swap 2 - Direct Rt modeling - same data, different Rt process vs fixed estimate
  - **Panel D**: Model comparison and convergence metrics across the three approaches: WAIC for each model variation (bar plot) and overlaid QQ PIT plots on case residuals for each model variation.


# Example 3: Recreating EpiNow2 configuration {#sec-example3}

<!-- Reference: https://epiforecasts.io/EpiNow2/ -->

Our final case study recreates a representative EpiNow2 configuration, demonstrating how our compositional approach can represent a complex inference and forecasting workflow.

- Describe modelling ideas in @epinow2
  - Renewal based modelling with generation intervals
  - Delayed observations of count time series (e.g. cases)
  - Forecasting capabilities including for downstream signals (e.g. deaths from case inference)
  - Negative binomial link with modifiers (e.g. day of week effects)
  - Nowcasting capabilities (_might be out of scope for this paper_)
- Describe swap in options:
  - Swap in Rt for ARIMA processes
    - Diff AR(1)
    - Some other choice?
- Choose a representative dataset
- Figure 2:
  - **Panel A**: EpiNow2 approach with default/close to default options - for representative dataset
  - **Panel B**: Compositional swap 1 - first ARIMA choice
  - **Panel C**: Compositional swap 2 - second ARIMA choice
  - **Panel D**: Model comparison and convergence metrics across the three approaches: WAIC for each model variation (bar plot) and overlaid QQ PIT plots on case residuals for each model variation.

# Conclusions {#sec-conclusions}

- Talk about how this has demonstated the potential of compositional approaches to epidemiological modelling 
  - Facilitated model comparison by isolating individual components.
  - Enabled rapid development with new model components.
  - Improve transparency: The compositional structure makes modelling assumptions explicit

## Future directions

Several avenues for future development emerge from this work:

- **Expanded component library**: Development of additional components covering specialized epidemiological scenarios
- **Automated model selection**: Tools for systematically exploring component combinations
- **Performance optimization**: Techniques for efficient inference in complex composed models
- **Integration with existing tools**: Bridges to popular epidemiological modelling packages

## Software availability

All code and data for reproducing the analyses in this paper are available at: https://github.com/EpiAware/PrototypeCompositionalProbablisticInfectiousDiseaseModelling. The compositional modelling framework is implemented as an open-source Julia package [`EpiAware`](https://github.com/seabbs/Rt-without-renewal).

# References {.unnumbered}

:::{#refs}
:::

# Appendix: Technical details {.unnumbered}

## Component interface specifications

<!-- TODO: Detailed API documentation -->

## Performance benchmarks

<!-- TODO: Computational performance comparisons -->
