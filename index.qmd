---
title: "Towards compositional epidemiological modelling"
author:
  - name: "Samuel P. C. Brand"
    affiliation: "Center for Forecasting and Outbreak Analysis; Centers for Disease Control"
    email: "usi1@cdc.gov"
    orcid: "0000-0003-0645-5367"
  - name: "Samuel Abbott"
    affiliation: "Centre for Mathematical Modelling of Infectious Diseases, London School of Hygiene & Tropical Medicine"
    email: "sam.abbott@lshtm.ac.uk" 
    orcid: "0000-0001-8057-8037"
date: today
abstract: |
  This paper presents a compositional approach to epidemiological modelling that enables "swap-in/swap-out" modelling decisions. We demonstrate the flexibility and power of this paradigm through three case studies that recreate existing infectious disease models using compositional components, showing how this design facilitates model comparison, validation, and methodological transparency in epidemiological research.
format:
  pdf:
    documentclass: article
    geometry: margin=1in
    fontsize: 11pt
    linestretch: 1.5
    keep-tex: false
    number-sections: false
    colorlinks: true
  html:
    toc: true
    number-sections: true
    embed-resources: true
bibliography: references.bib
csl: https://www.zotero.org/styles/plos-computational-biology
execute:
  echo: false
  warning: false
  cache: true
julia: 
  exeflags: ["+1.11.6", "--threads=8", "-O3"]
---

# Introduction {#sec-introduction}

- Introduce current common uses and limitations of epidemiological modelling in outbreak response and routine real-time surveillance.

## Current limitations in epidemiological modelling

- More specific details on limitations e.g. 
    - Monolithic model construction
    - Tight coupling between different model components,inference methods and implementation
    - Limited reusability and adaptability

- More specific details on problems this causes e.g.
    - Limited reusability, adaptability and retrospective evaluation.
        - Hard to isolate effect of specific modelling choices without large reimplementation.
        - Hard to introduce new/latest methods without large reimplementation.
    - Induces "Pipeline" approach where different models pass information rather than joint modelling.
        - Reduced transparency and reproducibility.
        - Complex implementations over many different models creates high barrier to entry.
    - Particularly problematic during outbreak response when inevitably there are new data sources.

# Compositional Epidemiological Modelling Approach {#sec-approach}

## Core design principles

- Outline/explain our compositional modelling paradigm e.g:
    - Core design principles
    - Complex epi models into a composition of modular reusable model components.
- Describe the core Latent vs Observation model split.
  - Describe a selection of submodels under this split.
- How this has become possible:
    - Advances in probabilistic programming (e.g. Turing)
    - Leveraging multiple dispatch e.g. structs in structs from Julia.

**Figure 1**: Schematic panel example. Based on talk to Turing.
  - A: Generic pattern. Branching structure of top level struct with args and modifying models demonstrating recursive dispatch.
  - B: Example: Building ARIMA as stack: `MA` -> `AR` -> `DiffLatentModel`
  - C: Example: Building Day of the week as stack: `TransformLatent` -> `BroadcastLatentModel` -> `Ascertainment`

## Contributions of this work

- Theoretical framework: Introduce the idea of combining epi models as input-output layers/submodels which are standalone models themselves (or descibed in a different way).
- Practical implementation: Talk about `EpiAware` struct in struct with method dispatch.
- Discuss layer/submodel modifiers in two contexts: 
    1. Extra details e.g. population structure
    2. Modelling refinements e.g. Day of week effects within a observation model
- Discuss passing the composed model to Pathfinder + Turing for inference.
- Quick overview of concrete case studies (unless this gets repetitive)

# Case Studies {#sec-case-studies}

## Example 1: Recreating Mishra et al. with compositional demonstration {#sec-example1}

<!-- Reference: https://arxiv.org/abs/2006.16487 -->
<!-- Implementation: https://cdcgov.github.io/Rt-without-renewal/stable/showcase/replications/mishra-2020/ -->

- Describe modelling ideas in @mishra2020covid 
  - Time-varying reproduction numbers according to an AR(2) process.
  - Convolution-based serial interval modelling i.e. Renewal model with Serial interval
  - Negative binomial observation models for case data
- Describe compositional model that recreates this model
- Figure 2: 
  - **Panel A**: Posterior predictive: Cases
  - **Panel B**: Posterior predictive: Rt
  - **Panel C**: Discretised serial interval pmf


![Posterior predictive results for South Korea COVID-19 case data. Top panel shows observed daily cases (black dots) with posterior predictive median (purple line) and credible intervals. Middle panel shows the estimated time-varying reproduction number Rt with uncertainty quantification. Bottom panel shows the discretised serial interval used in the Renewal model for Example 1.](examples/example1/fig2.png){#fig-example1-results}



## Example 2: Recreating EpiNow2 configuration {#sec-example2}

<!-- Reference: https://epiforecasts.io/EpiNow2/ -->

This case study recreates a representative EpiNow2 configuration, demonstrating how our compositional approach can represent a complex inference and forecasting workflow.

- Describe modelling ideas in @epinow2
  - Renewal based modelling with generation intervals  
  - Delayed observations of count time series (e.g. cases)
  - Negative binomial link with modifiers (e.g. day of week effects)
  - Focus on core functionality already implemented
- Describe compositional model that recreates this model
- Figure 3: Based on existing EpiNow2 replication work
  - **Panel ABC**: Recreate getting started first three panel plot https://epiforecasts.io/EpiNow2/articles/EpiNow2.html

## Example 3: Recreating Chatzilena et al. {#sec-example3}

<!-- Reference: https://www.sciencedirect.com/science/article/pii/S1755436519300325 -->
<!-- Implementation: https://cdcgov.github.io/Rt-without-renewal/stable/showcase/replications/chatzilena-2019/ -->

- Describe modelling ideas in @chatzilena2019contemporary
  - SIR model for classic influenza data set.
  - Poisson observations with fixed latent observation rate.
  - Conditionally Poisson observations with a latent observation rate (e.g. stochastic SIR model)
- Describe compositional model that recreates this model
- Figure 4: 
  - **Panel A**: Posterior predictive: cases using deterministic SIR model
  - **Panel B**: Posterior predictive: cases using stochastic SIR model

# Discussion {#sec-discussion}

## Demonstrated benefits of compositional modelling

- Talk about how this has demonstrated the potential of compositional approaches to epidemiological modelling 
  - Facilitated model comparison by isolating individual components.
  - Enabled rapid development with new model components.
  - Improve transparency: The compositional structure makes modelling assumptions explicit

## Implications for epidemiological practice

- How this approach addresses the limitations identified in the introduction
- Benefits for outbreak response and real-time surveillance
- Potential for improving reproducibility and transparency in epidemiological modelling

## Limitations and challenges

- Current limitations of the compositional approach
- Computational considerations
- Learning curve and adoption challenges

## Future directions

Several avenues for future development emerge from this work:

- **Expanded component library**: Development of additional components covering specialized epidemiological scenarios
- **Automated model selection**: Tools for systematically exploring component combinations
- **Performance optimization**: Techniques for efficient inference in complex composed models
- **Integration with existing tools**: Bridges to popular epidemiological modelling packages

# Conclusions {#sec-conclusions}

## Software availability

All code and data for reproducing the analyses in this paper are available at: https://github.com/EpiAware/PrototypeCompositionalProbablisticInfectiousDiseaseModelling. The compositional modelling framework is implemented as an open-source Julia package [`EpiAware`](https://github.com/seabbs/Rt-without-renewal).

# References {.unnumbered}

:::{#refs}
:::

# Appendix: Technical details {.unnumbered}

## Component interface specifications

<!-- TODO: Detailed API documentation -->

## Performance benchmarks

<!-- TODO: Computational performance comparisons -->
